<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>IP BGP Routing Configuration</title>
  <meta name="description" content="BGP routing is an important aspect of IP routing, which is the only one exterior gayeway routing protocol. There are two flavors: iBGP and eBGP, depennding o...">
  
  <meta name="author" content="Wenwei Weng">
  <meta name="copyright" content="&copy; Wenwei Weng 2023">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  

  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/networking/2019/10/17/Networking-BGP.html">
	<link rel="alternate" type="application/rss+xml" title="Wenwei Weng's Blog" href="http://localhost:4000/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/avatar.png" alt="Wenwei Weng's Blog">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">IP BGP Routing Configuration</h1>
      <p class="info">by <strong>Wenwei Weng</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">October 17, 2019</div>
  <div class="post-categories">
  in 
    
    <a href="/category/Networking">Networking</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>BGP routing is an important aspect of IP routing, which is the only one exterior gayeway routing protocol. There are two flavors: iBGP and eBGP, depennding on if the beighbors are in the same AS.
Especially EBGP, this is the routing protocol which routes the entire internet, connects between different ISPs, enterprise networks.
<img src="/uploads/networking/bgp-isp.jpg" alt="BGP routing between ISP" />
<!--more--></p>
<h2 id="bgp-routing">BGP routing</h2>
<p>The Internet is comprised of two parts: the internal fine-grained portions managed by an IGP such as OSPF, and the interconnections of those autonomous systems (AS) via BGP.
BGP Basics:</p>
<ul>
  <li>The current version of BGP is BGP version 4, based on RFC4271.</li>
  <li>BGP is the path-vector protocol that provides routing information for autonomous systems on the Internet via its AS-Path attribute.</li>
  <li>BGP is a Layer 4 protocol that sits on top of TCP, using port 179.</li>
  <li>BGP establises route by manually forming neighbors/Peers, exchange routing information between neighbors. Use “show ip bgp neighbor” or “show ip bgp summary” to see neighbors. The neighbors are not necessary to be physically connected neighbor, it can be logical neighbor, as long as it is IP reachable, with the help of IGP such as OSPF.</li>
  <li>BGP establishes its BGP database after receiving the routing information from neighbors. The database can be examnined by “show ip bgp”.</li>
  <li>BGP can insert BGP routes into router’s routing table depending on the weigh of route. By default, EBGP route has weight 20, IBGP route is 200, comparing to OSFP route is 100. These are well designed number, which we will see how important is.</li>
</ul>

<h2 id="configure-bgp-routing">Configure BGP routing</h2>

<p>Below is the network topology of two Autonomous Systems 500 and 600. I created the network by running Cisco IOL image.</p>

<p><img src="/uploads/networking/bgp-routing-topo.jpg" alt="BGP routing network topology" /></p>

<p>Some highlights:</p>
<ul>
  <li>Each router has a loopback 0 interface, e.g. R1 has loopback0 with ip address 11.11.11.11; R2 has loopback 0 with ip address 22.22.22.22.</li>
  <li>Each router has serial connections as WAN link, and Ethernet interface as LAN. WAN link is not supposed to be seen outside of AS, only LAN network is needed.</li>
  <li>OSPF will be used as IGP</li>
  <li>Loopback IP address will be used as neighbor address so that we can have redundancy especially in the case between R3 and R5.</li>
  <li>IBGP will use full mesh instead of route reflector.</li>
</ul>

<p>Following shows the IP address of each router.</p>

<p>R1:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R1#show ip interface brief 
Interface              IP-Address      OK? Method Status                Protocol
Ethernet0/0            10.1.1.1        YES NVRAM  up                    up      
Serial1/0              4.4.4.2         YES NVRAM  up                    up      
Serial2/0              1.1.1.1         YES NVRAM  up                    up      
Loopback0              11.11.11.11     YES manual up                    up      
R1#</code></pre></figure>

<p>R2:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R2#show ip interface brief 
Interface              IP-Address      OK? Method Status                Protocol
Ethernet0/0            20.1.1.1        YES NVRAM  up                    up      
Serial1/0              2.2.2.1         YES NVRAM  up                    up      
Serial2/0              1.1.1.2         YES NVRAM  up                    up      
Loopback0              22.22.22.22     YES manual up                    up      
R2#</code></pre></figure>

<p>R3:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R3#show ip interface brief 
Interface              IP-Address      OK? Method Status                Protocol
Ethernet0/0            30.1.1.1        YES NVRAM  up                    up      
Serial1/0              2.2.2.2         YES NVRAM  up                    up      
Serial2/0              3.3.3.1         YES NVRAM  up                    up      
Serial3/0              5.5.5.1         YES NVRAM  up                    up      
Serial4/0              6.6.6.1         YES manual up                    up      
Loopback0              33.33.33.33     YES manual up                    up      
R3#</code></pre></figure>

<p>R4:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R4#show ip interface brief 
Interface              IP-Address      OK? Method Status                Protocol
Ethernet0/0            40.1.1.1        YES NVRAM  up                    up      
Serial1/0              3.3.3.2         YES NVRAM  up                    up      
Serial2/0              4.4.4.1         YES NVRAM  up                    up      
Loopback0              44.44.44.44     YES manual up                    up      
R4#</code></pre></figure>

<p>R5:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R5#show ip interface brief 
Interface              IP-Address      OK? Method Status                Protocol
Ethernet0/0            50.1.1.1        YES NVRAM  up                    up      
Serial1/0              5.5.5.2         YES NVRAM  up                    up      
Serial2/0              6.6.6.2         YES manual up                    up      
Loopback0              55.55.55.55     YES NVRAM  up                    up      
R5#</code></pre></figure>

<h3 id="configure-ospf-as-igp-for-as-500">Configure OSPF as IGP for AS-500</h3>

<p>R1:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R1#show run | s ospf
router ospf 100
 network 1.0.0.0 0.255.255.255 area 0
 network 4.0.0.0 0.255.255.255 area 0
 network 10.0.0.0 0.255.255.255 area 0
 network 11.11.11.11 0.0.0.0 area 0
R1#
R1#show ip ospf neighbor 

Neighbor ID     Pri   State           Dead Time   Address         Interface
40.1.1.1          0   FULL/  -        00:00:30    4.4.4.1         Serial1/0
20.1.1.1          0   FULL/  -        00:00:31    1.1.1.2         Serial2/0
R1#show ip route ospf
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     2.0.0.0/8 <span class="o">[</span>110/128] via 1.1.1.2, 03:56:15, Serial2/0
O     3.0.0.0/8 <span class="o">[</span>110/128] via 4.4.4.1, 03:56:15, Serial1/0
O     20.0.0.0/8 <span class="o">[</span>110/74] via 1.1.1.2, 03:56:15, Serial2/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/65] via 1.1.1.2, 03:51:47, Serial2/0
O     30.0.0.0/8 <span class="o">[</span>110/138] via 4.4.4.1, 03:56:15, Serial1/0
                 <span class="o">[</span>110/138] via 1.1.1.2, 03:56:15, Serial2/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/129] via 4.4.4.1, 03:51:05, Serial1/0
                     <span class="o">[</span>110/129] via 1.1.1.2, 03:51:05, Serial2/0
O     40.0.0.0/8 <span class="o">[</span>110/74] via 4.4.4.1, 03:56:15, Serial1/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/65] via 4.4.4.1, 03:50:12, Serial1/0
R1#</code></pre></figure>

<p>R2:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R2#show running-config | s ospf
router ospf 100
 network 1.0.0.0 0.255.255.255 area 0
 network 2.0.0.0 0.255.255.255 area 0
 network 20.0.0.0 0.255.255.255 area 0
 network 22.22.22.22 0.0.0.0 area 0
R2#
R2#show running-config | s ospf
router ospf 100
 network 1.0.0.0 0.255.255.255 area 0
 network 2.0.0.0 0.255.255.255 area 0
 network 20.0.0.0 0.255.255.255 area 0
 network 22.22.22.22 0.0.0.0 area 0
R2#show ip ospf neighbor 

Neighbor ID     Pri   State           Dead Time   Address         Interface
30.1.1.1          0   FULL/  -        00:00:38    2.2.2.2         Serial1/0
10.1.1.1          0   FULL/  -        00:00:31    1.1.1.1         Serial2/0
R2#show ip route ospf
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     3.0.0.0/8 <span class="o">[</span>110/128] via 2.2.2.2, 03:59:33, Serial1/0
O     4.0.0.0/8 <span class="o">[</span>110/128] via 1.1.1.1, 03:59:43, Serial2/0
O     10.0.0.0/8 <span class="o">[</span>110/74] via 1.1.1.1, 03:59:43, Serial2/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/65] via 1.1.1.1, 03:55:50, Serial2/0
O     30.0.0.0/8 <span class="o">[</span>110/74] via 2.2.2.2, 03:59:33, Serial1/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/65] via 2.2.2.2, 03:54:24, Serial1/0
O     40.0.0.0/8 <span class="o">[</span>110/138] via 2.2.2.2, 03:59:33, Serial1/0
                 <span class="o">[</span>110/138] via 1.1.1.1, 03:59:33, Serial2/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/129] via 2.2.2.2, 03:53:31, Serial1/0
                     <span class="o">[</span>110/129] via 1.1.1.1, 03:53:31, Serial2/0
R2#</code></pre></figure>

<p>R3:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R3#show running-config | s ospf
router ospf 100
 network 2.0.0.0 0.255.255.255 area 0
 network 3.0.0.0 0.255.255.255 area 0
 network 30.0.0.0 0.255.255.255 area 0
 network 33.33.33.33 0.0.0.0 area 0
R3#show ip ospf neighbor

Neighbor ID     Pri   State           Dead Time   Address         Interface
40.1.1.1          0   FULL/  -        00:00:30    3.3.3.2         Serial2/0
20.1.1.1          0   FULL/  -        00:00:31    2.2.2.1         Serial1/0
R3#show ip route ospf
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     1.0.0.0/8 <span class="o">[</span>110/128] via 2.2.2.1, 04:00:56, Serial1/0
O     4.0.0.0/8 <span class="o">[</span>110/128] via 3.3.3.2, 04:00:46, Serial2/0
O     10.0.0.0/8 <span class="o">[</span>110/138] via 3.3.3.2, 04:00:46, Serial2/0
                 <span class="o">[</span>110/138] via 2.2.2.1, 04:00:56, Serial1/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/129] via 3.3.3.2, 03:57:04, Serial2/0
                     <span class="o">[</span>110/129] via 2.2.2.1, 03:57:04, Serial1/0
O     20.0.0.0/8 <span class="o">[</span>110/74] via 2.2.2.1, 04:00:56, Serial1/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/65] via 2.2.2.1, 03:56:20, Serial1/0
O     40.0.0.0/8 <span class="o">[</span>110/74] via 3.3.3.2, 04:00:46, Serial2/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/65] via 3.3.3.2, 03:54:45, Serial2/0
R3#</code></pre></figure>

<p>R4:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R4#show running | se ospf
router ospf 100
 network 3.0.0.0 0.255.255.255 area 0
 network 4.0.0.0 0.255.255.255 area 0
 network 40.0.0.0 0.255.255.255 area 0
 network 44.44.44.44 0.0.0.0 area 0
R4#show ip ospf neighbor

Neighbor ID     Pri   State           Dead Time   Address         Interface
10.1.1.1          0   FULL/  -        00:00:30    4.4.4.2         Serial2/0
30.1.1.1          0   FULL/  -        00:00:31    3.3.3.1         Serial1/0
R4#show ip route ospf
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     1.0.0.0/8 <span class="o">[</span>110/128] via 4.4.4.2, 04:02:06, Serial2/0
O     2.0.0.0/8 <span class="o">[</span>110/128] via 3.3.3.1, 04:02:16, Serial1/0
O     10.0.0.0/8 <span class="o">[</span>110/74] via 4.4.4.2, 04:02:06, Serial2/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/65] via 4.4.4.2, 03:58:25, Serial2/0
O     20.0.0.0/8 <span class="o">[</span>110/138] via 4.4.4.2, 04:02:06, Serial2/0
                 <span class="o">[</span>110/138] via 3.3.3.1, 04:02:16, Serial1/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/129] via 4.4.4.2, 03:57:41, Serial2/0
                     <span class="o">[</span>110/129] via 3.3.3.1, 03:57:41, Serial1/0
O     30.0.0.0/8 <span class="o">[</span>110/74] via 3.3.3.1, 04:02:16, Serial1/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/65] via 3.3.3.1, 03:56:59, Serial1/0
R4#</code></pre></figure>

<p>With above configuration, we should be able to ping from any router inside AS-500 to ping any interface IP inside AS-500.</p>

<p>If we don’t need to communicate outside, that is good enough. But that is not the internet about. we want to connect anywhere in the world! BGP comes to help for that!</p>

<h3 id="configure-ibgp-for-as-500-plus-ebg-for-r3">configure iBGP for AS-500, plus EBG for R3</h3>

<p>R1: only advertise LAN network, which is 10.0.0.0. No WAN interface exposed.
peer-group “bgp-pgrp1” is created to apply to all three iBGP neighbors R2, R3, R4. we do the similar in R2, R3 and R4.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R1#show running-config | s bgp
router bgp 500
 bgp log-neighbor-changes
 network 10.0.0.0
 neighbor bgp-pgrp1 peer-group
 neighbor bgp-pgrp1 remote-as 500
 neighbor bgp-pgrp1 update-source Loopback0
 neighbor bgp-pgrp1 version 4
 neighbor bgp-pgrp1 next-hop-self
 neighbor 22.22.22.22 peer-group bgp-pgrp1
 neighbor 33.33.33.33 peer-group bgp-pgrp1
 neighbor 44.44.44.44 peer-group bgp-pgrp1
R1#</code></pre></figure>

<p>R2: only advertise LAN network, which is 20.0.0.0.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R2#show run | se bgp
router bgp 500
 bgp log-neighbor-changes
 network 20.0.0.0
 neighbor bgp-pgrp1 peer-group
 neighbor bgp-pgrp1 remote-as 500
 neighbor bgp-pgrp1 update-source Loopback0
 neighbor bgp-pgrp1 version 4
 neighbor bgp-pgrp1 next-hop-self
 neighbor 11.11.11.11 peer-group bgp-pgrp1
 neighbor 33.33.33.33 peer-group bgp-pgrp1
 neighbor 44.44.44.44 peer-group bgp-pgrp1
R2#</code></pre></figure>

<p>R4: only advertise LAN network, which is 40.0.0.0.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R4#show run | s bgp
router bgp 500
 bgp log-neighbor-changes
 network 40.0.0.0
 neighbor bgp-pgrp1 peer-group
 neighbor bgp-pgrp1 remote-as 500
 neighbor bgp-pgrp1 update-source Loopback0
 neighbor bgp-pgrp1 version 4
 neighbor bgp-pgrp1 next-hop-self
 neighbor 11.11.11.11 peer-group bgp-pgrp1
 neighbor 22.22.22.22 peer-group bgp-pgrp1
 neighbor 33.33.33.33 peer-group bgp-pgrp1
R4#</code></pre></figure>

<p>R3:only advertise LAN network, which is 30.0.0.0. Here R% is added as EBGP neighbor
using loopback address 55.55.55.55 with remote-as 600. Also we need configure ebgp-multihop=2 as we use lookback interface, it takes two hops to reach R5 from R3.
Another important thing is next-hop-self, which says when it advertise route
(e.g. 50.0.0.0) from R5 to R1, R2, R4, it will use 33.33.33.33 as next hop address.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R3#show running-config | s bgp
router bgp 500
 bgp log-neighbor-changes
 network 30.0.0.0
 neighbor bgp-pgrp1 peer-group
 neighbor bgp-pgrp1 remote-as 500
 neighbor bgp-pgrp1 update-source Loopback0
 neighbor bgp-pgrp1 version 4
 neighbor bgp-pgrp1 next-hop-self
 neighbor 11.11.11.11 peer-group bgp-pgrp1
 neighbor 22.22.22.22 peer-group bgp-pgrp1
 neighbor 44.44.44.44 peer-group bgp-pgrp1
 neighbor 55.55.55.55 remote-as 600
 neighbor 55.55.55.55 ebgp-multihop 2
 neighbor 55.55.55.55 update-source Loopback0
R3#</code></pre></figure>

<p>R5: only advertise LAN network, which is 50.0.0.0.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R5#show running-config  | s bgp
router bgp 600
 bgp log-neighbor-changes
 network 50.0.0.0
 neighbor 33.33.33.33 remote-as 500
 neighbor 33.33.33.33 ebgp-multihop 2
 neighbor 33.33.33.33 update-source Loopback0
R5#</code></pre></figure>

<h3 id="check-bgp-neighor-and-datebase">Check BGP neighor and datebase</h3>
<p>R1:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R1#show ip bgp summary 
BGP router identifier 11.11.11.11, <span class="nb">local </span>AS number 500
BGP table version is 6, main routing table version 6
5 network entries using 700 bytes of memory
5 path entries using 380 bytes of memory
3/3 BGP path/bestpath attribute entries using 408 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1512 total bytes of memory
BGP activity 24/19 prefixes, 34/29 paths, scan interval 60 secs

Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
22.22.22.22     4          500     124     124        6    0    0 01:49:47        1
33.33.33.33     4          500     125     126        6    0    0 01:50:00        2
44.44.44.44     4          500     125     125        6    0    0 01:49:51        1
R1#show ip bgp         
BGP table version is 6, <span class="nb">local </span>router ID is 11.11.11.11
Status codes: s suppressed, d damped, h <span class="nb">history</span>, <span class="k">*</span> valid, <span class="o">&gt;</span> best, i - internal, 
              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
              x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

     Network          Next Hop            Metric LocPrf Weight Path
 <span class="k">*</span><span class="o">&gt;</span>  10.0.0.0         0.0.0.0                  0         32768 i
 r&gt;i 20.0.0.0         22.22.22.22              0    100      0 i
 r&gt;i 30.0.0.0         33.33.33.33              0    100      0 i
 r&gt;i 40.0.0.0         44.44.44.44              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>i 50.0.0.0         33.33.33.33              0    100      0 600 i
R1#</code></pre></figure>

<p>R2:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R2#show ip bgp summary 
BGP router identifier 22.22.22.22, <span class="nb">local </span>AS number 500
BGP table version is 6, main routing table version 6
5 network entries using 700 bytes of memory
5 path entries using 380 bytes of memory
3/3 BGP path/bestpath attribute entries using 408 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1512 total bytes of memory
BGP activity 22/17 prefixes, 23/18 paths, scan interval 60 secs

Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
11.11.11.11     4          500     125     125        6    0    0 01:50:41        1
33.33.33.33     4          500     128     126        6    0    0 01:50:41        2
44.44.44.44     4          500     126     126        6    0    0 01:50:41        1
R2#show ip bgp         
BGP table version is 6, <span class="nb">local </span>router ID is 22.22.22.22
Status codes: s suppressed, d damped, h <span class="nb">history</span>, <span class="k">*</span> valid, <span class="o">&gt;</span> best, i - internal, 
              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
              x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

     Network          Next Hop            Metric LocPrf Weight Path
 r&gt;i 10.0.0.0         11.11.11.11              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>  20.0.0.0         0.0.0.0                  0         32768 i
 r&gt;i 30.0.0.0         33.33.33.33              0    100      0 i
 r&gt;i 40.0.0.0         44.44.44.44              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>i 50.0.0.0         33.33.33.33              0    100      0 600 i
R2#</code></pre></figure>

<p>R3:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R3#show ip bgp summary 
BGP router identifier 33.33.33.33, <span class="nb">local </span>AS number 500
BGP table version is 6, main routing table version 6
5 network entries using 700 bytes of memory
5 path entries using 380 bytes of memory
3/3 BGP path/bestpath attribute entries using 408 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1512 total bytes of memory
BGP activity 24/19 prefixes, 35/30 paths, scan interval 60 secs

Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
11.11.11.11     4          500     129     127        6    0    0 01:52:06        1
22.22.22.22     4          500     128     129        6    0    0 01:51:53        1
44.44.44.44     4          500     126     130        6    0    0 01:51:58        1
55.55.55.55     4          600     128     126        6    0    0 01:52:09        1
R3#show ip bgp         
BGP table version is 6, <span class="nb">local </span>router ID is 33.33.33.33
Status codes: s suppressed, d damped, h <span class="nb">history</span>, <span class="k">*</span> valid, <span class="o">&gt;</span> best, i - internal, 
              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
              x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

     Network          Next Hop            Metric LocPrf Weight Path
 r&gt;i 10.0.0.0         11.11.11.11              0    100      0 i
 r&gt;i 20.0.0.0         22.22.22.22              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>  30.0.0.0         0.0.0.0                  0         32768 i
 r&gt;i 40.0.0.0         44.44.44.44              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>  50.0.0.0         55.55.55.55              0             0 600 i
R3#</code></pre></figure>

<p>R4:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R4#show ip bgp summary 
BGP router identifier 44.44.44.44, <span class="nb">local </span>AS number 500
BGP table version is 6, main routing table version 6
5 network entries using 700 bytes of memory
5 path entries using 380 bytes of memory
3/3 BGP path/bestpath attribute entries using 408 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1512 total bytes of memory
BGP activity 22/17 prefixes, 23/18 paths, scan interval 60 secs

Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
11.11.11.11     4          500     128     128        6    0    0 01:52:27        1
22.22.22.22     4          500     128     128        6    0    0 01:52:22        1
33.33.33.33     4          500     131     126        6    0    0 01:52:27        2
R4#show ip bgp         
BGP table version is 6, <span class="nb">local </span>router ID is 44.44.44.44
Status codes: s suppressed, d damped, h <span class="nb">history</span>, <span class="k">*</span> valid, <span class="o">&gt;</span> best, i - internal, 
              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
              x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

     Network          Next Hop            Metric LocPrf Weight Path
 r&gt;i 10.0.0.0         11.11.11.11              0    100      0 i
 r&gt;i 20.0.0.0         22.22.22.22              0    100      0 i
 r&gt;i 30.0.0.0         33.33.33.33              0    100      0 i
 <span class="k">*</span><span class="o">&gt;</span>  40.0.0.0         0.0.0.0                  0         32768 i
 <span class="k">*</span><span class="o">&gt;</span>i 50.0.0.0         33.33.33.33              0    100      0 600 i
R4#</code></pre></figure>

<p>R5:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R5#show ip bgp summary 
BGP router identifier 55.55.55.55, <span class="nb">local </span>AS number 600
BGP table version is 14, main routing table version 14
5 network entries using 700 bytes of memory
5 path entries using 380 bytes of memory
3/3 BGP path/bestpath attribute entries using 408 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1512 total bytes of memory
BGP activity 26/21 prefixes, 33/28 paths, scan interval 60 secs

Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
33.33.33.33     4          500     128     129       14    0    0 01:53:17        4
R5#show ip bgp         
BGP table version is 14, <span class="nb">local </span>router ID is 55.55.55.55
Status codes: s suppressed, d damped, h <span class="nb">history</span>, <span class="k">*</span> valid, <span class="o">&gt;</span> best, i - internal, 
              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, 
              x best-external, a additional-path, c RIB-compressed, 
Origin codes: i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

     Network          Next Hop            Metric LocPrf Weight Path
 <span class="k">*</span><span class="o">&gt;</span>  10.0.0.0         33.33.33.33                            0 500 i
 <span class="k">*</span><span class="o">&gt;</span>  20.0.0.0         33.33.33.33                            0 500 i
 <span class="k">*</span><span class="o">&gt;</span>  30.0.0.0         33.33.33.33              0             0 500 i
 <span class="k">*</span><span class="o">&gt;</span>  40.0.0.0         33.33.33.33                            0 500 i
 <span class="k">*</span><span class="o">&gt;</span>  50.0.0.0         0.0.0.0                  0         32768 i
R5#</code></pre></figure>

<h3 id="check-routing-table-and-veirify">check routing table and veirify</h3>

<p>R1:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R1#show ip route 
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

      </span>1.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        1.0.0.0/8 is directly connected, Serial2/0
L        1.1.1.1/32 is directly connected, Serial2/0
O     2.0.0.0/8 <span class="o">[</span>110/128] via 1.1.1.2, 04:20:45, Serial2/0
O     3.0.0.0/8 <span class="o">[</span>110/128] via 4.4.4.1, 04:20:45, Serial1/0
      4.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        4.0.0.0/8 is directly connected, Serial1/0
L        4.4.4.2/32 is directly connected, Serial1/0
      10.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        10.0.0.0/8 is directly connected, Ethernet0/0
L        10.1.1.1/32 is directly connected, Ethernet0/0
      11.0.0.0/32 is subnetted, 1 subnets
C        11.11.11.11 is directly connected, Loopback0
O     20.0.0.0/8 <span class="o">[</span>110/74] via 1.1.1.2, 04:20:45, Serial2/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/65] via 1.1.1.2, 04:16:17, Serial2/0
O     30.0.0.0/8 <span class="o">[</span>110/138] via 4.4.4.1, 04:20:45, Serial1/0
                 <span class="o">[</span>110/138] via 1.1.1.2, 04:20:45, Serial2/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/129] via 4.4.4.1, 04:15:35, Serial1/0
                     <span class="o">[</span>110/129] via 1.1.1.2, 04:15:35, Serial2/0
O     40.0.0.0/8 <span class="o">[</span>110/74] via 4.4.4.1, 04:20:45, Serial1/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/65] via 4.4.4.1, 04:14:42, Serial1/0
B     50.0.0.0/8 <span class="o">[</span>200/0] via 33.33.33.33, 01:53:05
R1#
R1#ping 50.1.1.1
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 50.1.1.1, <span class="nb">timeout </span>is 2 seconds:
.....
Success rate is 0 percent <span class="o">(</span>0/5<span class="o">)</span>
R1#ping 50.1.1.1 <span class="nb">source </span>10.1.1.1
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 50.1.1.1, <span class="nb">timeout </span>is 2 seconds:
Packet sent with a <span class="nb">source </span>address of 10.1.1.1 
<span class="o">!!!!!</span>
Success rate is 100 percent <span class="o">(</span>5/5<span class="o">)</span>, round-trip min/avg/max <span class="o">=</span> 24/26/32 ms
R1#</code></pre></figure>

<p>R2:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R2#show ip route 
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

      </span>1.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        1.0.0.0/8 is directly connected, Serial2/0
L        1.1.1.2/32 is directly connected, Serial2/0
      2.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        2.0.0.0/8 is directly connected, Serial1/0
L        2.2.2.1/32 is directly connected, Serial1/0
O     3.0.0.0/8 <span class="o">[</span>110/128] via 2.2.2.2, 04:23:05, Serial1/0
O     4.0.0.0/8 <span class="o">[</span>110/128] via 1.1.1.1, 04:23:15, Serial2/0
O     10.0.0.0/8 <span class="o">[</span>110/74] via 1.1.1.1, 04:23:15, Serial2/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/65] via 1.1.1.1, 04:19:22, Serial2/0
      20.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        20.0.0.0/8 is directly connected, Ethernet0/0
L        20.1.1.1/32 is directly connected, Ethernet0/0
      22.0.0.0/32 is subnetted, 1 subnets
C        22.22.22.22 is directly connected, Loopback0
O     30.0.0.0/8 <span class="o">[</span>110/74] via 2.2.2.2, 04:23:05, Serial1/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/65] via 2.2.2.2, 04:17:56, Serial1/0
O     40.0.0.0/8 <span class="o">[</span>110/138] via 2.2.2.2, 04:23:05, Serial1/0
                 <span class="o">[</span>110/138] via 1.1.1.1, 04:23:05, Serial2/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/129] via 2.2.2.2, 04:17:03, Serial1/0
                     <span class="o">[</span>110/129] via 1.1.1.1, 04:17:03, Serial2/0
B     50.0.0.0/8 <span class="o">[</span>200/0] via 33.33.33.33, 01:55:25
R2#</code></pre></figure>

<p>R3:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R3#show ip route 
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     1.0.0.0/8 <span class="o">[</span>110/128] via 2.2.2.1, 04:23:46, Serial1/0
      2.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        2.0.0.0/8 is directly connected, Serial1/0
L        2.2.2.2/32 is directly connected, Serial1/0
      3.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        3.0.0.0/8 is directly connected, Serial2/0
L        3.3.3.1/32 is directly connected, Serial2/0
O     4.0.0.0/8 <span class="o">[</span>110/128] via 3.3.3.2, 04:23:36, Serial2/0
      5.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        5.0.0.0/8 is directly connected, Serial3/0
L        5.5.5.1/32 is directly connected, Serial3/0
      6.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        6.6.6.0/24 is directly connected, Serial4/0
L        6.6.6.1/32 is directly connected, Serial4/0
O     10.0.0.0/8 <span class="o">[</span>110/138] via 3.3.3.2, 04:23:36, Serial2/0
                 <span class="o">[</span>110/138] via 2.2.2.1, 04:23:46, Serial1/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/129] via 3.3.3.2, 04:19:54, Serial2/0
                     <span class="o">[</span>110/129] via 2.2.2.1, 04:19:54, Serial1/0
O     20.0.0.0/8 <span class="o">[</span>110/74] via 2.2.2.1, 04:23:46, Serial1/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/65] via 2.2.2.1, 04:19:10, Serial1/0
      30.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        30.0.0.0/8 is directly connected, Ethernet0/0
L        30.1.1.1/32 is directly connected, Ethernet0/0
      33.0.0.0/32 is subnetted, 1 subnets
C        33.33.33.33 is directly connected, Loopback0
O     40.0.0.0/8 <span class="o">[</span>110/74] via 3.3.3.2, 04:23:36, Serial2/0
      44.0.0.0/32 is subnetted, 1 subnets
O        44.44.44.44 <span class="o">[</span>110/65] via 3.3.3.2, 04:17:35, Serial2/0
B     50.0.0.0/8 <span class="o">[</span>20/0] via 55.55.55.55, 01:56:03
      55.0.0.0/32 is subnetted, 1 subnets
S        55.55.55.55 <span class="o">[</span>1/0] via 5.5.5.2
R3#</code></pre></figure>

<p>R4:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R4#show ip route 
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

</span>O     1.0.0.0/8 <span class="o">[</span>110/128] via 4.4.4.2, 04:24:36, Serial2/0
O     2.0.0.0/8 <span class="o">[</span>110/128] via 3.3.3.1, 04:24:46, Serial1/0
      3.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        3.0.0.0/8 is directly connected, Serial1/0
L        3.3.3.2/32 is directly connected, Serial1/0
      4.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        4.0.0.0/8 is directly connected, Serial2/0
L        4.4.4.1/32 is directly connected, Serial2/0
O     10.0.0.0/8 <span class="o">[</span>110/74] via 4.4.4.2, 04:24:36, Serial2/0
      11.0.0.0/32 is subnetted, 1 subnets
O        11.11.11.11 <span class="o">[</span>110/65] via 4.4.4.2, 04:20:55, Serial2/0
O     20.0.0.0/8 <span class="o">[</span>110/138] via 4.4.4.2, 04:24:36, Serial2/0
                 <span class="o">[</span>110/138] via 3.3.3.1, 04:24:46, Serial1/0
      22.0.0.0/32 is subnetted, 1 subnets
O        22.22.22.22 <span class="o">[</span>110/129] via 4.4.4.2, 04:20:11, Serial2/0
                     <span class="o">[</span>110/129] via 3.3.3.1, 04:20:11, Serial1/0
O     30.0.0.0/8 <span class="o">[</span>110/74] via 3.3.3.1, 04:24:46, Serial1/0
      33.0.0.0/32 is subnetted, 1 subnets
O        33.33.33.33 <span class="o">[</span>110/65] via 3.3.3.1, 04:19:29, Serial1/0
      40.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        40.0.0.0/8 is directly connected, Ethernet0/0
L        40.1.1.1/32 is directly connected, Ethernet0/0
      44.0.0.0/32 is subnetted, 1 subnets
C        44.44.44.44 is directly connected, Loopback0
B     50.0.0.0/8 <span class="o">[</span>200/0] via 33.33.33.33, 01:56:58
R4# </code></pre></figure>

<p>R5:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">R5#show ip route 
Codes: L - <span class="nb">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external <span class="nb">type </span>1, N2 - OSPF NSSA external <span class="nb">type </span>2
       E1 - OSPF external <span class="nb">type </span>1, E2 - OSPF external <span class="nb">type </span>2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, <span class="k">*</span> - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not <span class="nb">set

      </span>5.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        5.0.0.0/8 is directly connected, Serial1/0
L        5.5.5.2/32 is directly connected, Serial1/0
      6.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        6.6.6.0/24 is directly connected, Serial2/0
L        6.6.6.2/32 is directly connected, Serial2/0
B     10.0.0.0/8 <span class="o">[</span>20/0] via 33.33.33.33, 01:54:11
B     20.0.0.0/8 <span class="o">[</span>20/0] via 33.33.33.33, 01:54:11
B     30.0.0.0/8 <span class="o">[</span>20/0] via 33.33.33.33, 01:54:42
      33.0.0.0/32 is subnetted, 1 subnets
S        33.33.33.33 <span class="o">[</span>1/0] via 5.5.5.1
B     40.0.0.0/8 <span class="o">[</span>20/0] via 33.33.33.33, 01:54:11
      50.0.0.0/8 is variably subnetted, 2 subnets, 2 masks
C        50.0.0.0/8 is directly connected, Ethernet0/0
L        50.1.1.1/32 is directly connected, Ethernet0/0
      55.0.0.0/32 is subnetted, 1 subnets
C        55.55.55.55 is directly connected, Loopback0
R5#</code></pre></figure>

<p>Some highlights:</p>
<ul>
  <li>For R1, R2, R3, R4, with BGP in place, BGP adds a new route for 50.0.0.0/8 network on top of OSPF routes.</li>
  <li>The next hop of 50.0.0.0 is 33.33.33.33, which is R3 loopback 0 IP, which is very important, as we don’t need to know WAN IP of R5, which is usually not available as it belongs to another AS/organization.</li>
  <li>When we try to ping 50.1.1.1 from R1, it fails without specify soure IP. This is because the default source IP of packet will be R1 WAN IP which is eith 1.1.1.1 or 4.4.4.2, which are not advetized to R5 (outsider), so it couldn’t reply ping packet. Howerver if we specify source IP as LAN (10.0.0.0) of R1, ping works, because R5 has route to 10.0.0.0, the next hop is 33.33.33.33, which R3. From R3, it surely knows how to get to R1 through OSPF route. Very nice!</li>
</ul>

<p>BGP is kind of simple but very powerful. It was started for ipv4 only, then later it gets extended to support mutiple protocol like ipv6, L2VPN, L3VPN, called as MP-BGP. It is backward compatible though. One of very popular use is in MPLS VPN network. MP-BGP is configured in PE routers to form iBGP, support vpnv4/vpnv6 address, so that PEs can exchange prefixes info needed by MPLS VPN, e.g. RD, labels etc. A good example can be found <a href="https://www.noction.com/blog/bgp-mpls-layer3-vpn-practical-configuration">here</a>.</p>

<p>Reference: BGP youtube video:
<a href="https://www.youtube.com/watch?v=G0qDnqOKwOE&amp;list=PLJqb_j53o7BiVPaFGQxEHhGx-ximMukwH"> BGP Video By Sikandar Shaik</a></p>


</article>





<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fnetworking%2F2019%2F10%2F17%2FNetworking-BGP.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Wenwei Weng's Blog</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:weweng@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">weweng@gmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://github.com/weweng" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">weweng</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.linkedin.com/in/wenwei-weng/" title="Connect with me on LinkedIn">
              <i class="fa fa-linkedin"></i>
              <span class="username">Wenwei Weng</span>
            </a>
          </li>
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">A simple yet classy theme for your Jekyll based blog.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
<script src="//unpkg.com/popper.js@1"></script>
<script src="//unpkg.com/tippy.js@5"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

	// Enable tooltips via Tippy.js
	if (Array.isArray(window.tooltips)) {
		window.tooltips.forEach(function(tooltip) {
			var selector = tooltip[0];
			var config = tooltip[1];
			tippy(selector, config);
		})
	}
});

</script>






  </body>

</html>
